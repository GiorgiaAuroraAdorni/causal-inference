\documentclass[a4paper,12pt]{article} % This defines the style of your paper

\usepackage[top = 2.5cm, bottom = 2.5cm, left = 2.5cm, right = 2.5cm]{geometry} 
\usepackage[utf8]{inputenc} %utf8 % lettere accentate da tastiera
\usepackage[english]{babel} % lingua del documento
\usepackage[T1]{fontenc} % codifica dei font

\usepackage{multirow} % Multirow is for tables with multiple rows within one 
%cell.
\usepackage{booktabs} % For even nicer tables.

\usepackage{graphicx} 

\usepackage{setspace}
\setlength{\parindent}{0in}

\usepackage{float}

\usepackage{fancyhdr}

\usepackage{caption}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{color}

\usepackage[hidelinks]{hyperref}
\usepackage{csquotes}
\usepackage{subfigure}

\usepackage{ifxetex,ifluatex}
\usepackage{etoolbox}
\usepackage[svgnames]{xcolor}

\usepackage{tikz}

\usepackage{framed}

\newcommand*\quotefont{\fontfamily{LinuxLibertineT-LF}} % selects Libertine as 
%the quote font


\newcommand*\quotesize{40} % if quote size changes, need a way to make shifts 
%relative
% Make commands for the quotes
\newcommand*{\openquote}
{\tikz[remember picture,overlay,xshift=-4ex,yshift=-1ex]
	\node (OQ) 
	{\quotefont\fontsize{\quotesize}{\quotesize}\selectfont``};\kern0pt}

\newcommand*{\closequote}[1]
{\tikz[remember picture,overlay,xshift=4ex,yshift=-1ex]
	\node (CQ) {\quotefont\fontsize{\quotesize}{\quotesize}\selectfont''};}

% select a colour for the shading
\colorlet{shadecolor}{WhiteSmoke}

\newcommand*\shadedauthorformat{\emph} % define format for the author argument

% Now a command to allow left, right and centre alignment of the author
\newcommand*\authoralign[1]{%
	\if#1l
	\def\authorfill{}\def\quotefill{\hfill}
	\else
	\if#1r
	\def\authorfill{\hfill}\def\quotefill{}
	\else
	\if#1c
	\gdef\authorfill{\hfill}\def\quotefill{\hfill}
	\else\typeout{Invalid option}
	\fi
	\fi
	\fi}
% wrap everything in its own environment which takes one argument (author) and 
%one optional argument
% specifying the alignment [l, r or c]
%
\newenvironment{shadequote}[2][l]%
{\authoralign{#1}
	\ifblank{#2}
	{\def\shadequoteauthor{}\def\yshift{-2ex}\def\quotefill{\hfill}}
	{\def\shadequoteauthor{\par\authorfill\shadedauthorformat{#2}}\def\yshift{2ex}}
	\begin{snugshade}\begin{quote}\openquote}
		{\shadequoteauthor\quotefill\closequote{\yshift}\end{quote}\end{snugshade}}

\newcommand{\footref}[1]{%
	$^{\ref{#1}}$%
}

\pagestyle{fancy}

\setlength\parindent{24pt}

\fancyhf{}

\lhead{\footnotesize Artificial Intelligence: Assignment 2}

\rhead{\footnotesize Giorgia Adorni}

\cfoot{\footnotesize \thepage} 


\usepackage{xcolor}
\usepackage{listings,lstautogobble}
\definecolor{gray}{gray}{0.5}
\colorlet{commentcolour}{green!50!black}
\colorlet{stringcolour}{red!60!black}
\colorlet{keywordcolour}{blue}
\colorlet{exceptioncolour}{yellow!50!red}
\colorlet{commandcolour}{magenta!90!black}
\colorlet{numpycolour}{blue!60!green}
\colorlet{literatecolour}{magenta!90!black}
\colorlet{promptcolour}{green!50!black}
\colorlet{specmethodcolour}{violet}

\newcommand{\footlabel}[2]{%
	\addtocounter{footnote}{1}%
	\footnotetext[\thefootnote]{%
		\addtocounter{footnote}{-1}%
		\refstepcounter{footnote}\label{#1}%
		#2%
	}%
	$^{\ref{#1}}$%
}

\newcommand*{\literatecolour}{\textcolor{literatecolour}}

\newcommand*{\pythonprompt}{\textcolor{promptcolour}{{>}{>}{>}}}

\lstdefinestyle{python}{
	language=python,
	showtabs=true,
	tab=,
	tabsize=4,
	basicstyle=\ttfamily\footnotesize,
	stringstyle=\color{stringcolour},
	showstringspaces=false,
	keywordstyle=\color{keywordcolour}\bfseries,
	emph={as,and,break,class,continue,def,yield,del,elif ,else,%
		except,exec,finally,for,from,global,if,in,%
		lambda,not,or,pass,print,raise,return,try,while,assert,with},
	emphstyle=\color{blue}\bfseries,
	emph={[2]True, False, None},
	emphstyle=[3]\color{commandcolour},
	morecomment=[s]{"""}{"""},
	commentstyle=\color{commentcolour}\slshape,
	emph={array, matmul, ones, transpose, float32},
	emphstyle=[4]\color{numpycolour},
	emph={[5]assert,yield},
	emphstyle=[5]\color{keywordcolour}\bfseries,
	emph={[6]range},
	emphstyle={[6]\color{keywordcolour}\bfseries},
	literate=*%
	{:}{{\literatecolour:}}{1}%
	{=}{{\literatecolour=}}{1}%
	{-}{{\literatecolour-}}{1}%
	{+}{{\literatecolour+}}{1}%
	{*}{{\literatecolour*}}{1}%
	{**}{{\literatecolour{**}}}2%
	{/}{{\literatecolour/}}{1}%
	{//}{{\literatecolour{//}}}2%
	{!}{{\literatecolour!}}{1}%
	{<}{{\literatecolour<}}{1}%
	{>}{{\literatecolour>}}{1}%
	{>>>}{\pythonprompt}{3},
	frame=trbl,
	rulecolor=\color{black!40},
	backgroundcolor=\color{gray!5},
	breakindent=.5\textwidth,
	frame=single,
	breaklines=true,
	basicstyle=\ttfamily\footnotesize,%
	keywordstyle=\color{keywordcolour},%
	emphstyle={[7]\color{keywordcolour}},%
	emphstyle=\color{exceptioncolour},%
	literate=*%
	{:}{{\literatecolour:}}{2}%
	{=}{{\literatecolour=}}{2}%
	{-}{{\literatecolour-}}{2}%
	{+}{{\literatecolour+}}{2}%
	{*}{{\literatecolour*}}2%
	{**}{{\literatecolour{**}}}3%
	{/}{{\literatecolour/}}{2}%
	{//}{{\literatecolour{//}}}{2}%
	{!}{{\literatecolour!}}{2}%
	{<}{{\literatecolour<}}{2}%
	{<=}{{\literatecolour{<=}}}3%
	{>}{{\literatecolour>}}{2}%
	{>=}{{\literatecolour{>=}}}3%
	{==}{{\literatecolour{==}}}3%
	{!=}{{\literatecolour{!=}}}3%
	{+=}{{\literatecolour{+=}}}3%
	{-=}{{\literatecolour{-=}}}3%
	{*=}{{\literatecolour{*=}}}3%
	{/=}{{\literatecolour{/=}}}3%
}

\lstnewenvironment{python}
{\lstset{style=python}}
{}


\begin{document}
	\thispagestyle{empty}  
	\noindent{
		\begin{tabular}{p{15cm}} 
			{\large \bf Artificial Intelligence} \\
			Università della Svizzera Italiana \\ Faculty of Informatics \\ 
			\today  \\
			\hline
			\\
		\end{tabular} 
		
		\vspace*{0.3cm} 
		
		\begin{center}
			{\Large \bf Assignment 2: Causal Inference}
			\vspace{2mm}
			
			{\bf Giorgia Adorni (giorgia.adorni@usi.ch)}
			
		\end{center}  
	}
	\vspace{0.4cm}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Structure of the Network}

The problem modelled is a generic trip by car, influenced by factors such as the strike of public transport, road works or even the weather, and the delay that comes with it. 
The causal diagram that model this problem includes the following variables:
\begin{itemize}
	\item \texttt{Weather}: weather during the journey that should be \textit{sunny} or \textit{rainy}.
	\item \texttt{Strike}: \textit{true} if a strike of public transport takes place, \textit{false} otherwise.
	\item \texttt{RushHour}: \textit{true} if the time it’s rush hour, \textit{false} otherwise.
	\item \texttt{RoadConditions}: condition of the road floor, that depends on the weather, and should be \textit{dry} or \textit{wet}.
	\item \texttt{Mood}: mood of the driver, dependent on the weather, that is \textit{good} or \textit{bad}.
	\item \texttt{RoadWorks}: \textit{true} if there are road maintenance works in progress, \textit{false} otherwise. This variable depends on the conditions of the road.
	\item \texttt{Speed}: driving velocity, that should be \textit{slow} or \textit{fast}, dependent on the road condition, if it’s rush hour and if there are road works.
	\item \texttt{Danger}: danger incurred during the trip, that should be \textit{low} or \textit{high}, dependent on the driving velocity, the road conditions and if it’s rush hour. %FIXME not completely measurable 
	\item \texttt{Accident}: \textit{true} if an accident occurred during the trip, \textit{false} otherwise. It is influenced by the danger, the mood of the driver and if there is a strike of the public transport.
	\item \texttt{Delay}: \textit{true} if the trip is delayed, \textit{false} otherwise.
\end{itemize}

The objective of the network is highlight how weather and humour impacts on travel safety. 
The graph could provide valuable indications about the correlation between the driver humour and a delayed trip, or for example between the weather and the risk of an accident and also on how the road conditions influences car crashes.

Each node is connected by an arrow to one or more other nodes upon which it has a causal influence. Most of the arcs orientation are self-explaining. An exception was made for the \texttt{Mood} variable, that influences the accident risk and is caused only by the weather and not for example by the delay. 

\begin{figure}[H]
	\centering
	\includegraphics[width=.9\linewidth]{../code/network.pdf}	
	\caption{Bayesian Network}
	\label{fig:net}
\end{figure}

An arc can be inverted if and only if no v-structures, i.e. colliders in which the parents are not adjacent, are generated or destroyed in doing so.
 
In the model there are only two arrow that can be inverted, and these are the one that goes from the variable \texttt{Weather} to \texttt{Mood} and the one that goes from the variable \texttt{Weather} to \texttt{RoadConditions}.
In fact, even inverting the two arrows no v-structured are created, therefore the three graphs that are generated by the reversions of the two arcs are equivalent and not distinguishable by any statistical test.

Instead, the arc from \texttt{RoadWorks} to \texttt{RoadConditions} cannot be reverted since doing this a v-structure is created. Hence, the arc could only be turned on condition of turn also the one between 
\texttt{Weather} and \texttt{RoadConditions}.

\begin{figure}[H]
	\centering
	\includegraphics[width=\linewidth]{../code/network-vstructures.pdf}	
	\caption{V-Structures}
	\label{fig:vstructure}
\end{figure}

\subsection*{D-Separation}
D-Separation tells when two variables are d-separated along a path (blocked), that means independent and when they are d-connected along a path (unblocked) or likely dependent.
They are actually independent if they are d-separated along all possible paths.
They are likely dependent if there is at least one unblocked path connecting them.

A path is blocked by a set of nodes if and only if the path contains a chain of nodes or a fork such that the middle node is in the set of nodes or if the path contains a collider such that the collision node and every descendant are not in the given set of nodes. 

\begin{itemize}
	\item X: \texttt{RushHour}, Y: \texttt{RoadConditions}:\\
	X and Y are d-separated without conditioning on any variable since there are only blocked colliders. Even conditioning on one of the variables \texttt{Strike}, \texttt{RoadWorks} \texttt{Weather} or \texttt{Mood}, \texttt{RushHour} and \texttt{RoadConditions} are d-separated since the path from these two variables are all blocked.
	
	They are independent since they are d-separated along all the paths, in fact, in a real problem the rush hour does not depend on the road conditions and nor the vice-versa. 
	
	\item X: \texttt{Speed}, Y: \texttt{Accident}:\\
	In this case, without conditioning on some variables, X and Y are not d-separated. Instead, conditioning on \texttt{Danger}, \texttt{RoadConditions} they are d-separated. 
	
	It is clear how in the real word, an accident depend on the driving velocity.  
	
	\item X: \texttt{RoadConditions}, Y: \texttt{Strike}:\\
	In this case the same considerations made for the first example. 
	
	Clearly, the possibility of a strike is not dependent on the road conditions and nor the vice-versa. 
	
	\item X: \texttt{Speed}, Y: \texttt{Mood}:\\
	In this case, without conditioning on some variables, X and Y are not d-separated. Instead, conditioning on \texttt{RoadConditions} or \texttt{Weather}, the two variable becomes d-separated.
	So, we cannot say that X and Y are independent, since they are not d-separated along all the paths.
	
	Knowing that \texttt{Weather} is a confounder for X and Y, in the real world, it influences both the driving velocity and the mood of a driver.

\end{itemize}

\section{Conditional Probability Tables}

The Conditional Probability Tables (CPTs) of the variables of the model, that show all possible inputs and outcomes with their associated probabilities, are filled sometimes using information retrieved from online survey, other times are estimated based on common sense.
In case of the variable \texttt{Weather}, the prior probability is difficult to estimate because it is dependent on different factors, such as the location. For this reason I decided to use some information retrieved online\footlabel{note1}{\url{https://www.climatestotravel.com/climate/switzerland}} about the average precipitation in Lugano. Also the probabilities associated to the variable \texttt{Strike} are obtained from internet and referred to the number of strike of the public transport in Lugano.


\begin{figure}[H]
	\begin{center}	
	\begin{minipage}[c]{.3\textwidth}
		\centering
		\includegraphics[width=.5\linewidth]{../code/strike.pdf}	
		\caption*{Strike CPT}
		\label{fig:strike}
	\end{minipage}
	~
	\begin{minipage}[c]{.3\textwidth}
		\centering
		\includegraphics[width=.5\linewidth]{../code/weather.pdf}	
		\caption*{Weather CPT}
		\label{fig:weather}
	\end{minipage}
	~
	\begin{minipage}[c]{.3\textwidth}
		\centering
		\includegraphics[width=.5\linewidth]{../code/rushhour.pdf}	
		\caption*{RushHour CPT}
		\label{fig:rushhour}
	\end{minipage}

	\begin{minipage}[c]{.31\textwidth}
		\centering
		\includegraphics[width=.9\linewidth]{../code/roadconditions.pdf}	
		\caption*{RoadConditions CPT}
		\label{fig:roadconditions}
	\end{minipage}
	~
	\begin{minipage}[c]{.28\textwidth}
		\centering
		\includegraphics[width=.9\linewidth]{../code/mood.pdf}	
		\caption*{Mood CPT}
		\label{fig:Mood}
	\end{minipage}
	~
	\begin{minipage}[c]{.35\textwidth}
		\centering
		
		\includegraphics[width=.9\linewidth]{../code/roadworks.pdf}	
		\caption*{RoadWorks CPT}
		\label{fig:roadworks}
	\end{minipage}
	\end{center}
\end{figure}

\begin{figure}[H]
	\begin{center}	
	\begin{minipage}[c]{.5\textwidth}
		\centering
		\includegraphics[width=\linewidth]{../code/speed.pdf}	
		\caption*{Speed CPT}
		\label{fig:speed}
	\end{minipage}
	~
	\begin{minipage}[c]{.45\textwidth}
		\centering
		\includegraphics[width=\linewidth]{../code/danger.pdf}	
		\caption*{Danger CPT}
		\label{fig:danger}
	\end{minipage}

	\centering
	\begin{minipage}[c]{.45\textwidth}
		\centering
		\includegraphics[width=.9\linewidth]{../code/accident.pdf}	
		\caption*{Accident CPT}
		\label{fig:accident}
	\end{minipage}
	~
	\begin{minipage}[c]{.45\textwidth}
		\centering
		\includegraphics[width=.9\linewidth]{../code/delay.pdf}	
		\caption*{Delay CPT}
		\label{fig:delay}
	\end{minipage}

\end{center}
\end{figure}

\section{Causal Inference}

\subsection*{Causal Effect}
Given the graph, and a pair of variables \texttt{X}: \texttt{Speed} and \texttt{Y}: \texttt{Accident}. In this case, \texttt{A}: \texttt{RoadConditions} and \texttt{B}: \texttt{RushHour} are the backdoor variables. Then the causal effect of \texttt{X} on \texttt{Y} is given by the following formula:
\begin{equation}
	\text{P}(Y = y \mid {do}(X = x)) = \sum_{A}^{}\sum_{B}^{}	\text{P}(Y = y \mid X = x, A = a, B = b)\text{P}(A = a, B = b)
\end{equation}
where $a$, $b$, $y$ and $x$ range over all the combinations of values that the associated variable can take.
Calculating the cases in which $\mathtt{Y}: \{ y_0=\mathtt{false}, y_1=\mathtt{true}\}$ given $\mathtt{X}: \{ x_0=\mathtt{slow}, x_1=\mathtt{fast}\}$ :

\begin{equation*}
\begin{aligned}
\text{P}(y_0 \mid {do}(x_0)) = \sum_{A}^{}\sum_{B}^{}	\text{P}(y_0 \mid x_0, A = a, B = b)\text{P}(A = a, B = b)  = 0.6062	
\\
\text{P}(y_1 \mid {do}(x_0)) = \sum_{A}^{}\sum_{B}^{}	\text{P}(y_1 \mid x_0, A = a, B = b)\text{P}(A = a, B = b) = 0.3938
\\
\text{P}(y_0 \mid {do}(x_1)) = \sum_{A}^{}\sum_{B}^{}	\text{P}(y_0 \mid x_1, A = a, B = b)\text{P}(A = a, B = b) =  0.4053	
\\
\text{P}(y_1 \mid {do}(x_1)) = \sum_{A}^{}\sum_{B}^{}	\text{P}(y_1 \mid x_1, A = a, B = b)\text{P}(A = a, B = b) =  0.5947
\end{aligned}
\end{equation*}

\subsection*{Confounders}
Given the variables \texttt{X}: \texttt{Speed} and \texttt{Y}: \texttt{Accident}, to identify possible confounders it is necessary to recognise ancestors of X such that they causes a spurious association with Y. In this case, the possible confounder are \texttt{RoadWorks}, \texttt{RoadConditions}, \texttt{RushHour} and \texttt{Weather}.

\subsection*{Randomised Controlled Study}
With this specific problem is not possible to perform randomised controlled study on every variable, for example we cannot influence the weather.

If we are interested in performing a randomised controlled study to disentangle the causal effect of \texttt{X}: \texttt{Speed} on \texttt{Y}: \texttt{Accident} from their correlation it is necessary to fix or vary randomly the variable \texttt{X}. In this case it is possible, for example introducing a speed limit to control the driving velocity and reduce the number of accidents. Although this is not a perfect example, because introducing a speed limit does not guarantee that people will comply with it.

\subsection*{Average Causal Effect}
The Average Causal Effect (ACE) of X on Y is computed for both the possible values of the variable \texttt{Accident}, that are $\mathtt{Y}: \{ y_0=\mathtt{false}, y_1=\mathtt{true}\}$ 
\begin{equation}
\begin{aligned}
\text{ACE}&=\text{P}(y_0 \mid {do}(x_0)) -\text{P}(y_0 \mid {do}(x_1)) \approx 0.2009
\\
\text{ACE}&=\text{P}(y_1 \mid {do}(x_0)) -\text{P}(y_1 \mid {do}(x_1)) \approx -0.2009
\end{aligned}
\end{equation}

\subsection*{C-Specific Effect}
Given a new pair of variable such that \texttt{X}: \texttt{RoadWorks} and \texttt{Y}: \texttt{Speed}, and chosen \texttt{C}: \texttt{Weather}, the C-Specific Effect is given by:

\begin{equation}
P(Y=y|do(X=x), C=c)= \sum_{z} P(Y=y|X=x, C=c, Z=z) P(Z=z|C=c)
\end{equation}
The set Z identified, such that $C \cup Z$ satisfy the backdoor criterion, includes the variable \texttt{RoadConditions}.
Defined $\mathtt{X}: \{ x_0=\mathtt{false}, x_1=\mathtt{true}\}$, $\mathtt{Y}: \{ y_0=\mathtt{slow}, y_1=\mathtt{fast}\}$ and $\mathtt{C}: \{ c_0=\mathtt{sun}, c_1=\mathtt{rain}\}$ it is possible to compute the C-Specific Effect for all the possible realisation of the variables as follows: 

\begin{equation*}
P(y_0|do(x_0), c_0)= \sum_{z} P(y_0|x_0, c_0, z) P(z|c_0)=0.3880
\end{equation*}

\begin{equation*}
P(y_1|do(x_0), c_0)= \sum_{z} P(y_1|x_0, c_0, z) P(z|c_0)=0.6129
\end{equation*}

\begin{equation*}
P(y_0|do(x_1), c_0)= \sum_{z} P(y_0|x_1, c_0, z) P(z|c_0)=0.8120
\end{equation*}

\begin{equation*}
P(y_1|do(x_1), c_0)= \sum_{z} P(y_1|x_1, c_0, z) P(z|c_0)=0.1880
\end{equation*}

\begin{equation*}
P(y_0|do(x_0), c_1)= \sum_{z} P(y_0|x_0, c_1, z) P(z|c_1)=0.5680
\end{equation*}

\begin{equation*}
P(y_1|do(x_0), c_1)= \sum_{z} P(y_1|x_0, c_1, z) P(z|c_1)=0.4320
\end{equation*}

\begin{equation*}
P(y_0|do(x_1), c_1)= \sum_{z} P(y_0|x_1, c_1, z) P(z|c_1)=0.8820
\end{equation*}

\begin{equation*}
P(y_1|do(x_1), c_1)= \sum_{z} P(y_1|x_1, c_1, z) P(z|c_1)=0.1180
\end{equation*}

\begin{figure}[H]
	\centering
	\includegraphics[width=.5\linewidth]{../code/c-specific-effect.png}	
	\caption*{CPT C-Specific Effect}
	\label{fig:c-specific-effect}
\end{figure}
	%FIXME
The minimal set of variables that must be measured in order to estimate the c-specific effect of X on Y includes \texttt{RoadWorks}, \texttt{Speed}, \texttt{Weather} and \texttt{RoadConditions}.

\subsection*{Conditional Intervention}
Given the variables \texttt{X}: \texttt{RoadWorks} and \texttt{Y}: \texttt{Speed}, and chosen \texttt{C}: \texttt{Weather}, the Conditional Interventions in which we are interested is: 

$$P(Y=y|do(X=g(C)))$$

where $$ g(C) := \left\{\begin{array}{lr}
false, & \text{if } C=rain\\
true, & \text{if } C=sun
\end{array}\right\}$$
Then the conditional intervention is computed using 
\begin{equation}
	P(Y=y|do(X=g(C))) = \sum_c P(Y=y|do(X=g(C)), C=c)P(C=c)
\end{equation}
Then, 
\begin{equation*}
\begin{aligned}
P(Y=y_0|do(X=g(C))) = \sum_c P(Y=y_0|do(X=g(C)), C=c)P(C=c) = 0.7388\\
P(Y=y_1|do(X=g(C))) = \sum_c P(Y=y_1|do(X=g(C)), C=c)P(C=c) = 0.2612
\end{aligned}
\end{equation*}

\subsection*{Mediation and Controlled Direct Effect}
Given a new pair of variable such that \texttt{X}: \texttt{RoadConditions} and \texttt{Y}: \texttt{Speed}, the variable \texttt{M}: \texttt{RoadWorks} is a mediation variable between \texttt{X} and \texttt{Y}.
The Controlled Direct Effect is computed with the following formula:
\begin{equation}
	\text{CDE} = P(Y = y|\mathrm{do}(X = x),\mathrm{do}(M = m)) - P(Y = y|\mathrm{do}(X = x'),\mathrm{do}(M = m))
\end{equation}
Since there are not any spurious path between X and Y, neither between Y and M, the formula can be rewritten as follows:
\begin{equation*}
\text{CDE} = P(y| x, m) - P(y|x',m)
\end{equation*}
Defined $\mathtt{X}: \{ x_0=\mathtt{dry}, x_1=\mathtt{wet}\}$, $\mathtt{Y}: \{ y_0=\mathtt{slow}, y_1=\mathtt{fast}\}$, $\mathtt{M}: \{ m_0=\mathtt{false}, m_1=\mathtt{true}\}$ the CME are: 
\begin{equation*}
\begin{aligned}
\text{CDE} &= P(y_0|\mathrm{do}(x_0),\mathrm{do}(m_0)) - P(y_0|\mathrm{do}(x_1),\mathrm{do}(m_0)) = 0.720 - 0.360 = 0.360\\
\text{CDE} &= P(y_1|\mathrm{do}(x_0),\mathrm{do}(m_0)) - P(y_1|\mathrm{do}(x_1),\mathrm{do}(m_0))= 0.23 - 0.090 = 0.140\\
\text{CDE} &= P(y_0|\mathrm{do}(x_0),\mathrm{do}(m_1)) - P(y_0|\mathrm{do}(x_1),\mathrm{do}(m_1))=0.28 - 0.64 = -0.36\\
\text{CDE} &= P(y_1|\mathrm{do}(x_0),\mathrm{do}(m_1)) - P(y_1|\mathrm{do}(x_1),\mathrm{do}(m_1))=0.770 - 0.910 = -0.14
\end{aligned}
\end{equation*}

\section{Simulation}
\subsection*{Causal Effect and ACE}
Given the graph, and a pair of variables \texttt{X}: \texttt{Speed} and \texttt{Y}: \texttt{Accident} and supposing we are not able to measure \texttt{RushHour}, that is a parent of X, we are interested in computing the Causal Effect of X on Y.
In this case, since \texttt{RushHour} is a backdoor variable, ut unmeasurable, we cannot apply the backdoor criterion. In addition, we cannot rely on the frontdoor criterion, since using the variable \texttt{Danger} as frontdoor variable, the criterion is not abided.
So, it is not possible to estimate the casual effect of X on Y.

Moreover, the Average Causal Effect is not estimable since we cannot rely on the estimate of the causal effect. The consideration about the possible confounders are the same explained before, as well as those made for the Randomise Control Study.

\subsection*{C-Specific Effect and Conditional Intervention}
Given a new pair of variable such that \texttt{X}: \texttt{RoadWorks} and \texttt{Y}: \texttt{Speed}, and chosen \texttt{C}: \texttt{Weather}, and supposing we are not able to measure \texttt{RoadConditions}, as before we cannot relay neither on the backdoor and the frontdoor criterion. In conclusion, the C-Specific Effect of X on Y is not estimable.
The same conclusion as before occurs: since the variables involved in the Conditional Intervention are the same, the Conditional Intervention of X on Y is not estimable.

\subsection*{Mediation and Controlled Direct Effect}
Given \texttt{X}: \texttt{RoadConditions} and \texttt{Y}: \texttt{Speed}, the mediation variable \texttt{M}: \texttt{RoadWorks} and supposing we are not able to measure \texttt{Weather}, the Controlled Direct Effect is computed exactly in the same way as before. In fact, since the formula does not require the values of the unmeasured variable, the results are:
\begin{equation*}
\begin{aligned}
\text{CDE} &= P(y_0|\mathrm{do}(x_0),\mathrm{do}(m_0)) - P(y_0|\mathrm{do}(x_1),\mathrm{do}(m_0)) = 0.720 - 0.360 = 0.360\\
\text{CDE} &= P(y_1|\mathrm{do}(x_0),\mathrm{do}(m_0)) - P(y_1|\mathrm{do}(x_1),\mathrm{do}(m_0))= 0.23 - 0.090 = 0.140\\
\text{CDE} &= P(y_0|\mathrm{do}(x_0),\mathrm{do}(m_1)) - P(y_0|\mathrm{do}(x_1),\mathrm{do}(m_1))=0.28 - 0.64 = -0.36\\
\text{CDE} &= P(y_1|\mathrm{do}(x_0),\mathrm{do}(m_1)) - P(y_1|\mathrm{do}(x_1),\mathrm{do}(m_1))=0.770 - 0.910 = -0.14
\end{aligned}
\end{equation*}

\section{Comment on the Results}
In general, the model behaves as expected: all the queries have results not so far to my expectations.  
Improvements to the model include the addition of variables and relationships. Moreover, including real-values variables could make the model more realistic.


\end{document}
